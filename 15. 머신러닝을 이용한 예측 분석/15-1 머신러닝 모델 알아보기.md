## 📌 머신러닝 모델 알아보기

### 🙆 머신러닝 모델이란?

**머신러닝 모델 만들기 = 함수 만들기**
- 머신러닝 모델은 함수와 비슷하다.
- 함수에 값을 입력하면 규칙에 따라 계산한 값을 출력하듯이 머신러닝 모델도 값을 입력하면 정해진 규칙에 따라 계산한 예측값을 출력한다.
- 함수를 만들 때는 사람이 계산 규칙을 정해 입력해야 하지만 머신러닝 모델을 만들 때는 사람이 계산 규칙을 정하지 않고 컴퓨터가 데이터에서 패턴을 찾아 스스로 규칙을 정한다.


![image](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/bc5e84ff-8525-4811-a223-5219a2e02fa0)

- 예를 들어 환자의 정보를 입력해 당뇨병 발병 여부를 예측하는 모델을 만든다면, 사람이 해야 할 일은 여러 환자의 정보와 당뇨병 발병 여부 데이터를 수집해 머신러닝 알고리즘에 입력하는 것 뿐이다.
- 컴퓨터는 환자의 정보와 당뇨병 발병 간의 패턴을 찾아낸 다음 환자의 정보를 입력하면 당뇨병 발병 여부를 출력하는 모델을 만든다.
- 어떤 사람의 당뇨병 발병여부를 알고 싶다면 환자의 정보를 모델에 입력하기만 하면 된다.

**예측 변수와 타겟 변수**
- 머신러닝 모델을 만들 때 두 종류의 변수를 사용한다.
  - 예측 변수(predictor variable): 예측하는 데 활용하는 변수 또는 모델에 입력하는 값을 예측 변수라고 한다.
  - 타겟 변수(target variable): 예측하고자 하는 변수 또는 모델이 출력하는 값을 타겟 변수라고 한다.
 
- 만약 환자의 성별, 나이, 흡연 여부, 음주 여부로 당뇨병 발병을 예측하는 모델을 만든다면 성별, 나이, 흡연 여부, 음주 여부는 예측 변수로 사용하고, 당뇨병 발병 여부는 타겟변수로 사용한다.

**머신러닝 모델을 이용해 미래 예측하기**
- 머신러닝 모델은 미래의 값을 예측하는 용도로 자주 사용된다.
- 과거의 값을 예측 변수로 사용하고 미래의 값을 타겟 변수로 사용하면 미래를 예측하는 모델을 만들 수 있다.
- 예를 들어 현재 환자의 신체 정보를 입력하면 3년 뒤의 당뇨병 발병 여부를 예측하는 모델을 만들 수 있다.
- 머신러닝 모델은 다양한 사업 영역에서 미래를 예측하는 데 활용된다.
- 온라인 커머스는 고객이 구매할 가능성이 높은 상품을 예측해 추천하고, 마케팅사는 서비스에 가입할 가능성이 높은 이용자를 예측해 홍보 전화를 건다.
- 미래를 예측하면 부가 수익을 창출하고 비용을 줄일 수 있으므로 머신러닝은 여러 분야에서 주목받는 기술이다.
  
------------------------
### 🌳 의사결정나무 모델
- 머신러닝 모델은 종류가 매우 다양하고 새로운 알고리즘이 끊임없이 개발되고 있다.
- 그 중에서 의사결정나무 모델은 구조가 단순하고 작동 원리를 이해하기 쉬워 여러분야에 사용되고있다.
- 규모가 크고 복잡한 모델도 의사결정나무 모델에 기반을 두고 만들 때가 있다.

**의사결정나무 모델이란?**
- 의사결정나무 모델은 마치 스무고개 놀이처럼 순서대로 주어진 질문에 Yes/No로 답하면 마지막에 결론을 얻는 구조로 되어있다.
- 질문이 나열된 모양이 가지를 뻗은 '나무'와 비슷하고, 예측값을 무엇으로 할지 '의사 결정'해주기 때문에 의사결정나무라는 이름을 가지고 있다.


![image](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/12733b81-db22-4ceb-bea3-57e68a0fa9f2)


**의사결정나무 모델을 이용해 예측하기**

![KakaoTalk_20230901_143431782](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/554b2b50-8b45-48dd-b2bd-a8a5d9004564)

- 의사결정나무 모델을 만들면 Yes/No로 답할 수 있는 질문 목록을 갖게 된다.
- 새 데이터가 주어졌을 때 질문 목록에 따라 순서대로 답을 하면 최종적으로 둘 중 한 가지의 값을 부여받게 된다.
- 예를 들어 환자의 나이, 흡연 여부, 음주 여부로 당뇨병 발병 여부를 예측하는 모델을 만들었다고 가정해보자.


![KakaoTalk_20230901_143431782_01](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/6f4e11c3-ac3d-4d78-93fc-deb399c8df47)
- 새로 온 환자 A는 나이가 45세이고 음주는 하지 않는다고 할 때 모델의 첫 번째 질문은 '나이가 40세 이하인가?"이므로 A의 대답은 'No'이므로 오른쪽 가지를 타고 내려온다.
- 두 번째로 마주한 질문 '음주 여부'에 A의 대답은 'no' 이므로 이번에도 오른쪽 가지를 타고 내려간다.
- 최종적으로 환자 A는 '정상'으로 예측된다.


![KakaoTalk_20230901_143431782_02](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/5aa204ab-d77d-47aa-adba-dcea58d4be7e)

- 두번째 환자 B는 나이가 30세이고 흡연을 한다.
- B는 40세 이하이므로 첫 번째 질문의 대답이 'yes'이므로 왼쪽 가지를 타고 내려간다.
- 두 번째로 마주한 질문 '흡연 여부'의 대답은 'yes'이므로 왼쪽 가지를 타고 내려간다.
- 최종적으로 환자 B는 '발병'으로 예측된다.
- 이처럼 데이터에 모델의 질문에 답할 수 있는 값만 있으면 발병/정상 둘 중 한 가지로 예측값을 부여하게 된다.
  
-------------------------
**🎄 의사결정나무 모델이 만들어지는 원리**
- 다음과 같이 4가지 예측 변수로 당뇨병 발생 여부를 예측하는 모델을 만든다고 가정하고 모델이 만들어지는 과정을 단계별로 살펴보자.
    - 예측 변수 : 흡연 여부, 음주 여부, 성별, 나이
    - 타겟 변수 : 당뇨병 발병 여부

**1단계. 타겟 변수를 가장 잘 분리하는 예측 변수 선택하기**
- 의사결정나무 모델은 어떤 순서로 어떤 질문을 할지 정하는 과정을 거쳐 만들어진다.
- 가장 먼저 첫 번째 질문을 할 때 예측 변수 중에서 무엇을 사용할지 정한다.
- 의사결정나무 알고리즘은 '타겟 변수를 가장 잘 분리해주는 예측 변수'를 찾아 첫 번째 질문으로 삼는다.
- 예측 변수가 타겟 변수를 분리해주는 정도는 다음 절차로 알 수 있다.

**(1) 모든 예측 변수를 Yes/No로 답할 수 있는 질문으로 만든다.**
  - '흡연 여부'는 '흡연을 하십니까?', '음주 여부'는 '음주를 하십니까?', '성별'은 '남자입니까?' 또는 '여자입니까?'의 형태로 만든다.

**(2) 모델을 만드는데 사용할 데이터를 앞에서 만든 각각의 질문에 대입한 다음 'Yes'로 답한 데이터만 추출한다.**

**(3) 추출한 데이터 중 발병인과 정상인의 비율을 구한다.**
  - 발병인과 정상인의 비율 차이가 크면 클수록 예측 변수가 타겟 변수를 잘 분리해낸다고 볼 수 있다.

![KakaoTalk_20230901_143431782_03](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/55b7a5af-e2ad-4700-b204-ad4a7f931978)

-  위의 그림을 보면 '성별 = 남자'는 'yes'로 답한 사람 중 발병과 정상의 비율이 둘 다 50%로 같다. 🙅‍♂️ 그러므로 성별을 묻는 것은 발병과 정상을 분리해 내는데 별로 도움이 되지 못한다.
- '음주 여부'는 성별 보다 발병과 정상을 잘 분리해 내며 음주 여부에 'Yes'라고 답한 사람을 전부 환자로 분류하면 적어도 60%는 맞출 수 있다.
- 셋 중에 타겟 변수를 가장 잘 분리 해주는 예측 변수는 '흡연 여부'이다. 적어도 80%를 맞출 수 있다.
- 당뇨병 발병 여부를 예측하는데 질문을 딱 하나만 해야 한다면 흡연 여부를 물어봐야한다.
  
----------
- 앞에서 살펴본 변수는 범주 변수이므로 yes/no로 답할 수 있는 질문을 곧 바로 만들 수 있었지만 나이와 같은 연속 변수는 그렇지 않다.
- 연속 변수는 '나이가 x세 이하인가?'의 형태로 질문을 만들어야 yes/no로 답할 수 있다.
- 이때 몇 세를 기준으로 질문할지 정해야한다.
- 타겟 변수를 가장 잘 분리해주는 기준 나이를 알아낼려면 '18세 이하인가?' , '19세 이하인가?' ... '60세 이하인가?'와 같이 가능한 모든 경우의 수대로 질문 후보를 만들어 비교한다.

![KakaoTalk_20230901_143431782_04](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/2ca0f8eb-8fa8-4e1a-9b33-6a17bdd21230)

- 이처럼 모든 예측 변수로 질문을 만든 다음 타겟 변수를 가장 잘 분리해주는 변수를 찾아 첫 번째 질문에 사용한다.
- 이 예에서는 흡연 여부를 선택하게 된다.

![KakaoTalk_20230901_143431782_05](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/c822eea3-8813-46e7-9c0e-bcd236db37dd)

**2단계. 첫 번째 질문의 답변에 따라 데이터를 두 노드로 분할하기**
- 질문의 답변이 같아서 함께 분류된 집단을 노드(node)라고 한다.
- 노드는 의사결정나무 도식에 사각형으로 표현한다.
- 전체 데이터를 첫 번째 질문의 답변에 따라 서로 다른 노드로 보낸다. 앞의 예에서는 '흡연 여부'의 답변이 'yes'면 왼쪽 노드, 'no'면 오른쪽 노드로 보내면 된다.

 ![KakaoTalk_20230901_143431782_06](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/d2d8ff87-5557-4169-94aa-4c41981eafb1)

**3단계. 각 노드에서 타겟 변수를 가장 잘 분리하는 예측 변수 선택하기**
- 각 노드에서 타겟 변수를 가장 잘 분리해주는 예측 변수를 선택한다.
- 1단계 작업을 노드별로 반복하는 것이다.
- '흡연 여부'는 이미 사용했으니 제외하고 나머지 변수 중에서 타겟 변수를 가장 잘 분리해주는 두 번째 예측 변수를 찾으면 된다.

<img width="563" alt="image" src="https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/af4970e3-d380-4d51-aa33-923cb1e19413">

**4단계. 노드가 완벽하게 분리될 때까지 반복하기**
- 노드에 한 범주만 남아 완벽하게 분리될 때 까지 변수를 선택하고 노드를 분할하는 과정을 반복한다.
- 노드에 발병과 정상 중 한 쪽 범주만 남으면 분할을 종료한다.

![KakaoTalk_20230901_143431782_08](https://github.com/sm9199/Python_Data_Analysis_Study/assets/128019851/825f05d2-c640-49a0-98f9-c9f4fb920f80)

------------------

## 🌳의사결정나무 모델의 특징

**1. 노드마다 분할 횟수가 다르다**
- 예측 변수를 선택하고 노드를 분할하는 횟수가 노드마다 다르므로 가지가 뻗어 나간 횟수도 노드마다 제각각이다.
- 어떤 노드에서는 다섯 번 분할해야 한 범주만 남지만 어떤 노드는 두 번만에 한 범주만 남을 수 있다.
- 따라서 모든 사람에게 같은 횟수로 질문하는 게 아니라 앞의 질문에 어떻게 답변했는지에 따라 서로 다른 횟수로 질문하게 된다.

**2. 노드마다 선택되는 예측 변수가 다르다**
- 예측 변수 선택 작업을 노드별로 따로 하므로 노드마다 선택되는 변수가 다르다.
- 예를 들어 흡연자에게는 '음주 여부'가, 비흡연자에게는 '나이'가 타겟 변수를 가장 잘 분리해주는 예측 변수일 수도 있다.
- 모든 사람에게 일괄적으로 같은 질문을 하는 것이 아닌 앞의 질문에 어떻게 답변했는지에 따라 서로 다른 질문을 한다.

**3. 어떤 예측 변수는 모델에서 탈락한다**
- 어떤 예측 변수는 노드를 분할하는 과정에서 한 번도 선택되지 않아 모델에서 탈락할 수 있다.
- 예를 들어 당뇨병 발병 예측 모델을 만들 때 '발 크기' 변수는 타겟 변수를 분리해주는 정도가 다른 변수보다 항상 떨어져서 분할을 종료할 때까지 한 번도 선택되지 않을 수 있다.
- 따라서 데이터에 들어있는 모든 변수를 사용하는게 아니라 일부는 사용하고 일부는 제외하게 된다.
